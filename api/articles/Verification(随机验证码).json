{"title":"随机验证码","slug":"Verification(随机验证码)","date":"2017-02-23T05:58:46.823Z","updated":"2017-02-23T06:08:08.000Z","comments":true,"excerpt":"","content":"<h3 id=\"随机验证码\"><a href=\"#随机验证码\" class=\"headerlink\" title=\"随机验证码\"></a>随机验证码</h3><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div></pre></td><td class=\"code\"><pre><div class=\"line\">$width = <span class=\"number\">80</span>;</div><div class=\"line\">$height = <span class=\"number\">30</span>;</div><div class=\"line\">$type = <span class=\"number\">3</span>;</div><div class=\"line\">$len = <span class=\"number\">4</span>;</div><div class=\"line\">$line = <span class=\"number\">4</span>;</div><div class=\"line\">$pixel = <span class=\"number\">50</span>;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// 1.创建画布</span></div><div class=\"line\">$image = imagecreatetruecolor($width,$height);</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// 2.创建颜色</span></div><div class=\"line\">$white = imagecolorallocate($image,<span class=\"number\">255</span>,<span class=\"number\">255</span>,<span class=\"number\">255</span>);</div><div class=\"line\">$black = imagecolorallocate($image,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>);</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// 3.填充整个矩形区域</span></div><div class=\"line\">imagefilledrectangle($image,<span class=\"number\">1</span>,<span class=\"number\">1</span>,$width<span class=\"number\">-2</span>,$height<span class=\"number\">-2</span>,$white);</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// 4.准备字符串</span></div><div class=\"line\">$str = getStr($type,$len);</div><div class=\"line\"><span class=\"comment\">// 5.准备字体</span></div><div class=\"line\">$fontFile = <span class=\"keyword\">array</span>(<span class=\"string\">\"Deng.ttf\"</span>,<span class=\"string\">\"Dengb.ttf\"</span>,<span class=\"string\">\"Dengl.ttf\"</span>,<span class=\"string\">\"FZYTK.TTF\"</span>,</div><div class=\"line\"><span class=\"string\">\"msyh.ttc\"</span>,</div><div class=\"line\"><span class=\"string\">\"msyhbd.ttc\"</span>,</div><div class=\"line\"><span class=\"string\">\"msyhl.ttc\"</span>,</div><div class=\"line\"><span class=\"string\">\"simfang.ttf\"</span>,</div><div class=\"line\"><span class=\"string\">\"STLITI.TTF\"</span>,</div><div class=\"line\"><span class=\"string\">\"STXINWEI.TTF\"</span>);</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// 6.单独绘制文字</span></div><div class=\"line\"><span class=\"keyword\">for</span>($i=<span class=\"number\">0</span>; $i&lt;strlen($str); $i++)&#123;</div><div class=\"line\">    $size = mt_rand(<span class=\"number\">14</span>, <span class=\"number\">18</span>);</div><div class=\"line\">    $angle = mt_rand(<span class=\"number\">-15</span>, <span class=\"number\">15</span>);</div><div class=\"line\">    $x = <span class=\"number\">5</span> + $size*$i;</div><div class=\"line\">    $y = mt_rand(<span class=\"number\">20</span>, <span class=\"number\">26</span>);</div><div class=\"line\">    $color = imagecolorallocate($image, mt_rand(<span class=\"number\">90</span>, <span class=\"number\">120</span>),mt_rand(<span class=\"number\">100</span>,<span class=\"number\">200</span>),mt_rand(<span class=\"number\">120</span>,<span class=\"number\">250</span>));</div><div class=\"line\">    $font_file = <span class=\"string\">\"font/\"</span>.$fontFile[mt_rand(<span class=\"number\">0</span>,count($fontFile)<span class=\"number\">-1</span>)];</div><div class=\"line\">    $text = substr($str,$i,<span class=\"number\">1</span>);</div><div class=\"line\">    imagettftext($image, $size, $angle, $x, $y, $color, $font_file, $text);</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// 7.干扰元素--点</span></div><div class=\"line\"><span class=\"keyword\">if</span>($pixel)&#123;</div><div class=\"line\">    <span class=\"keyword\">for</span>($i=<span class=\"number\">0</span>; $i&lt;$pixel; $i++)&#123;</div><div class=\"line\">        imagesetpixel($image, mt_rand(<span class=\"number\">1</span>, $width<span class=\"number\">-2</span>), mt_rand(<span class=\"number\">1</span>, $height<span class=\"number\">-2</span>), $black);</div><div class=\"line\">&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// 9.干扰元素--线</span></div><div class=\"line\"><span class=\"keyword\">if</span>($line)&#123;</div><div class=\"line\">    <span class=\"keyword\">for</span>($i=<span class=\"number\">0</span>; $i&lt;$line; $i++)&#123;</div><div class=\"line\">        $color = imagecolorallocate($image, mt_rand(<span class=\"number\">90</span>, <span class=\"number\">120</span>),mt_rand(<span class=\"number\">100</span>,<span class=\"number\">200</span>),mt_rand(<span class=\"number\">120</span>,<span class=\"number\">250</span>));</div><div class=\"line\">        imageline($image, mt_rand(<span class=\"number\">1</span>, $width<span class=\"number\">-2</span>), mt_rand(<span class=\"number\">0</span>, $height<span class=\"number\">-2</span>), mt_rand(<span class=\"number\">1</span>, $width<span class=\"number\">-2</span>), mt_rand(<span class=\"number\">0</span>, $height<span class=\"number\">-2</span>),$color);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// 输出图片</span></div><div class=\"line\">header(<span class=\"string\">\"content-type:image/gif\"</span>);</div><div class=\"line\"><span class=\"comment\">// 输出图像到浏览器或文件</span></div><div class=\"line\">imagegif($image);</div><div class=\"line\"><span class=\"comment\">// 销毁一图像</span></div><div class=\"line\">imagedestroy($image);</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * <span class=\"doctag\">@param</span> $type 类型：1-纯数字； 2-纯字母； 3-数字+字母</div><div class=\"line\"> * <span class=\"doctag\">@param</span> $len 验证码的长度</div><div class=\"line\"> * <span class=\"doctag\">@return</span> string 验证码的字符串</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getStr</span><span class=\"params\">($type=<span class=\"number\">1</span>,$len=<span class=\"number\">4</span>)</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> ($type == <span class=\"number\">1</span>) &#123;</div><div class=\"line\">        $str = <span class=\"string\">\"1234567890\"</span>;</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ($type == <span class=\"number\">2</span>) &#123;</div><div class=\"line\">        $str = <span class=\"string\">\"dsajfoisadjf\"</span>;</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        $str = <span class=\"string\">\"1234567890abcdefghijklmnopqrstuvwxyz\"</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// 将字符串打乱</span></div><div class=\"line\">    $chars = str_shuffle($str);</div><div class=\"line\">    <span class=\"comment\">// 截取$len个长度的字符串，并返回</span></div><div class=\"line\">    <span class=\"keyword\">return</span> substr($chars, <span class=\"number\">0</span>, $len);</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>","categories":[],"tags":[]}